<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD - INTERFACE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Gerenciador de Itens</h1>

        <!-- Mensagens de feedback -->
        <div id="message" class="message" style="display: none;"></div>

        <!-- Formulário para adicionar/editar -->
        <div class="form-group">
            <label for="itemName">Nome do Item:</label>
            <input type="text" id="itemName" placeholder="Digite o nome do item...">
        </div>

        <div class="form-group">
            <button class="btn btn-primary" onclick="addItem()">Adicionar Item</button>
            <button class="btn btn-secondary" onclick="loadItems()">Atualizar Lista</button>
            <button class="btn btn-secondary" onclick="clearForm()">Limpar</button>
        </div>

        <!-- Lista de itens -->
        <div class="items-list">
            <h2>Itens Cadastrados</h2>
            <div id="itemsContainer" class="loading">
                Clique em "Atualizar Lista" para carregar os itens...
            </div>
        </div>
    </div>

    <script>
        // Variável para controlar se estamos editando
        let editingItemId = null;

        // Função para mostrar mensagens
        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // Esconder a mensagem após 5 segundos
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Função para limpar o formulário
        function clearForm() {
            document.getElementById('itemName').value = '';
            editingItemId = null;
            showMessage('Formulário limpo!', 'success');
        }

        // FUNÇÃO: Adicionar item
        async function addItem() {
            const nameInput = document.getElementById('itemName');
            const name = nameInput.value.trim();

            if (!name) {
                showMessage('Por favor, digite um nome para o item!', 'error');
                return;
            }

            try {
                const response = await fetch('http://localhost:3005/items', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: name })
                });

                if (response.ok) {
                    showMessage('Item adicionado com sucesso!');
                    nameInput.value = '';
                    loadItems(); // Atualiza a lista automaticamente
                } else {
                    showMessage('Erro ao adicionar item!', 'error');
                }
            } catch (error) {
                showMessage('Erro de conexão!', 'error');
                console.error('Error:', error);
            }
        }

        // FUNÇÃO: Carregar todos os itens
        async function loadItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '<div class="loading">Carregando itens...</div>';

            try {
                const response = await fetch('http://localhost:3005/items');
                const items = await response.json();

                if (items.length === 0) {
                    container.innerHTML = '<div class="loading">Nenhum item cadastrado.</div>';
                    return;
                }

                // Construir HTML dos itens
                let html = '';
                items.forEach(item => {
                    html += `
                        <div class="item-card">
                            <div class="item-info">
                                <strong>ID: ${item.id}</strong> - ${item.name}
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-secondary" onclick="editItem(${item.id}, '${item.name.replace(/'/g, "\\'")}')">
                                    Editar
                                </button>
                                <button class="btn btn-danger" onclick="deleteItem(${item.id})">
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                showMessage('Lista atualizada!');

            } catch (error) {
                container.innerHTML = '<div class="loading error">Erro ao carregar itens.</div>';
                showMessage('Erro ao carregar itens!', 'error');
                console.error('Error:', error);
            }
        }

        // FUNÇÃO: Editar item (preenche o formulário)
        function editItem(id, name) {
            document.getElementById('itemName').value = name;
            editingItemId = id;
            showMessage(`Editando item ID: ${id} - Clique em "Atualizar Item" para salvar.`);
            
            // Muda o botão para "Atualizar"
            const addButton = document.querySelector('.btn-primary');
            addButton.textContent = 'Atualizar Item';
            addButton.onclick = updateItem;
        }

        // FUNÇÃO: Atualizar item
        async function updateItem() {
            if (!editingItemId) {
                showMessage('Nenhum item selecionado para edição!', 'error');
                return;
            }

            const name = document.getElementById('itemName').value.trim();
            if (!name) {
                showMessage('Por favor, digite um nome para o item!', 'error');
                return;
            }

            try {
                const response = await fetch(`http://localhost:3005/items/${editingItemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: name })
                });

                if (response.ok) {
                    showMessage('Item atualizado com sucesso!');
                    clearForm();
                    loadItems();
                    
                    // Volta o botão ao normal
                    const addButton = document.querySelector('.btn-primary');
                    addButton.textContent = 'Adicionar Item';
                    addButton.onclick = addItem;
                } else {
                    showMessage('Erro ao atualizar item!', 'error');
                }
            } catch (error) {
                showMessage('Erro de conexão!', 'error');
                console.error('Error:', error);
            }
        }

        // FUNÇÃO: Excluir item
        async function deleteItem(id) {
            if (!confirm('Tem certeza que deseja excluir este item?')) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:3005/items/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Item excluído com sucesso!');
                    loadItems(); // Atualiza a lista
                } else {
                    showMessage('❌ Erro ao excluir item!', 'error');
                }
            } catch (error) {
                showMessage('❌ Erro de conexão!', 'error');
                console.error('Error:', error);
            }
        }

        // Carregar itens quando a página abre
        document.addEventListener('DOMContentLoaded', function() {
            loadItems();
        });
    </script>
</body>
</html>